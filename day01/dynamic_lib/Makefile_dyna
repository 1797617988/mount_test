# 定义编译器和编译选项
CC = gcc
CFLAGS = -Wall -fPIC

# 定义目标和文件
TARGET = mymain          # 可执行程序名称
SRCS = mymain.c          # 主程序源文件
LIB_SRC = my_qsort.c     # 动态库源文件
LIB_NAME = libmyqsort.so # 动态库名称
OBJS = $(SRCS:.c=.o)     # 自动生成目标文件列表

# 默认目标：生成可执行文件
all: $(TARGET)

# 生成可执行文件（链接动态库）
$(TARGET): $(OBJS) $(LIB_NAME)
	$(CC) -o $@ $(OBJS) -L. -lmyqsort

# 编译主程序（使用模式规则）
%.o: %.c
	$(CC) $(CFLAGS) -c $< -o $@

# 生成动态库
$(LIB_NAME): $(LIB_SRC)
	$(CC) $(CFLAGS) -shared -o $@ $<

# 清理生成的文件
clean:
	rm -f $(TARGET) $(OBJS) $(LIB_NAME)

# 运行程序（自动设置库路径）
run: $(TARGET)
	LD_LIBRARY_PATH=. ./$(TARGET)

.PHONY: all clean run