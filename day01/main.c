// main.c
#include "stdio.h"
void Hello(const char * arg);

int main() {
    Hello("World");  // è°ƒç”¨é™æ€åº“ä¸­çš„å‡½æ•°
    return 0;
}

//gcc main.c -o main -L. -ltest

/*
ä»¥ä¸‹æ˜¯å°† `test.c` ç¼–è¯‘ä¸ºåŠ¨æ€åº“ï¼ˆ`.so`ï¼‰ï¼Œå¹¶åœ¨ `main.c` ä¸­é“¾æ¥ä½¿ç”¨çš„å®Œæ•´æ­¥éª¤å’ŒæŒ‡ä»¤ï¼š

---

### ğŸ“ ä¸€ã€æ–‡ä»¶ç»“æ„å‡†å¤‡
1. **å¤´æ–‡ä»¶ `test.h`**ï¼ˆå£°æ˜å‡½æ•°æ¥å£ï¼Œä¾› `main.c` è°ƒç”¨ï¼‰ï¼š
   ```c
   // test.h
   #ifndef TEST_H
   #define TEST_H
   void Hello(const char *arg);
   #endif
   ```

2. **åŠ¨æ€åº“æºæ–‡ä»¶ `test.c`**ï¼š
   ```c
   // test.c
   #include <stdio.h>
   #include "test.h"
   void Hello(const char *arg) {
       printf("Hello %s\n", arg);
   }
   ```

3. **ä¸»ç¨‹åº `main.c`**ï¼š
   ```c
   // main.c
   #include "test.h"
   int main() {
       Hello("World");  // è°ƒç”¨åŠ¨æ€åº“ä¸­çš„å‡½æ•°
       return 0;
   }
   ```

---

### ğŸ”§ äºŒã€ç¼–è¯‘åŠ¨æ€åº“ `libtest.so`
åœ¨ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
# ç¼–è¯‘ä¸ºä½ç½®æ— å…³ä»£ç ï¼ˆ-fPICï¼‰ï¼Œå¹¶ç”ŸæˆåŠ¨æ€åº“ï¼ˆ-sharedï¼‰
gcc -fPIC -shared -o libtest.so test.c
```
- **å…³é”®å‚æ•°**ï¼š
  - `-fPIC`ï¼šç”Ÿæˆä½ç½®æ— å…³ä»£ç ï¼ˆå¿…éœ€ï¼Œç¡®ä¿åŠ¨æ€åº“å¯è¢«å¤šè¿›ç¨‹å…±äº«ï¼‰ã€‚
  - `-shared`ï¼šæŒ‡å®šç”ŸæˆåŠ¨æ€åº“ï¼ˆè€Œéå¯æ‰§è¡Œæ–‡ä»¶ï¼‰ã€‚
- **è¾“å‡ºæ–‡ä»¶**ï¼š`libtest.so`ï¼ˆå‘½åæ ¼å¼å¿…é¡»æ˜¯ `lib<åç§°>.so`ï¼‰ã€‚

---

### ğŸ”— ä¸‰ã€ç¼–è¯‘ `main.c` å¹¶é“¾æ¥åŠ¨æ€åº“
```bash
# é“¾æ¥åŠ¨æ€åº“ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
gcc main.c -o main -L. -ltest
```
- **å…³é”®å‚æ•°**ï¼š
  - `-L.`ï¼šæŒ‡å®šåŠ¨æ€åº“æœç´¢è·¯å¾„ä¸ºå½“å‰ç›®å½•ã€‚
  - `-ltest`ï¼šé“¾æ¥åä¸º `libtest.so` çš„åº“ï¼ˆçœç•¥ `lib` å‰ç¼€å’Œ `.so` åç¼€ï¼‰ã€‚
- **è¾“å‡ºæ–‡ä»¶**ï¼šå¯æ‰§è¡Œæ–‡ä»¶ `main`ã€‚

---

### âš ï¸ å››ã€è§£å†³åŠ¨æ€åº“åŠ è½½é—®é¢˜
ç›´æ¥è¿è¡Œ `./main` å¯èƒ½æŠ¥é”™ **`cannot open shared object file`**ï¼Œå› ä¸ºç³»ç»Ÿé»˜è®¤åœ¨ `/usr/lib` ç­‰ç›®å½•æœç´¢åŠ¨æ€åº“ï¼Œéœ€æ‰‹åŠ¨æŒ‡å®šå½“å‰ç›®å½•ï¼š
#### æ–¹æ³• 1ï¼šä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¨èæµ‹è¯•ç”¨ï¼‰
```bash
export LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH  # å°†å½“å‰ç›®å½•åŠ å…¥åº“æœç´¢è·¯å¾„
./main  # å†è¿è¡Œç¨‹åº
```

#### æ–¹æ³• 2ï¼šæ°¸ä¹…é…ç½®ï¼ˆéœ€ root æƒé™ï¼‰
```bash
sudo cp libtest.so /usr/lib         # å¤åˆ¶åº“åˆ°ç³»ç»Ÿç›®å½•
sudo ldconfig                       # æ›´æ–°åº“ç¼“å­˜
./main                              # ç›´æ¥è¿è¡Œ
```

#### æ–¹æ³• 3ï¼šé€šè¿‡ `rpath` ç¡¬ç¼–ç è·¯å¾„ï¼ˆç¼–è¯‘æ—¶æŒ‡å®šï¼‰
```bash
gcc main.c -o main -L. -ltest -Wl,-rpath='$ORIGIN'  # è¿è¡Œæ—¶ä¼˜å…ˆæœç´¢ç¨‹åºæ‰€åœ¨ç›®å½•
./main  # æ— éœ€é¢å¤–é…ç½®
```

---

### âœ… äº”ã€éªŒè¯è¿è¡Œ
```bash
./main
```
**è¾“å‡º**ï¼š
```
Hello World
```

---

### ğŸ’¡ å®Œæ•´æµç¨‹ç¤ºä¾‹
```bash
# 1. ç”ŸæˆåŠ¨æ€åº“
gcc -fPIC -shared -o libtest.so test.c

# 2. ç¼–è¯‘ä¸»ç¨‹åºå¹¶é“¾æ¥åŠ¨æ€åº“
gcc main.c -o main -L. -ltest

# 3. è®¾ç½®åº“æœç´¢è·¯å¾„ï¼ˆä¸´æ—¶ï¼‰
export LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH

# 4. è¿è¡Œ
./main
```

---

### âš ï¸ å¸¸è§é—®é¢˜
1. **å¤´æ–‡ä»¶ç¼ºå¤±**ï¼š  
   ç¡®ä¿ `test.h` å’Œ `main.c` åœ¨åŒä¸€ç›®å½•ï¼Œå¦åˆ™ç¼–è¯‘æ—¶éœ€ç”¨ `-I` æŒ‡å®šå¤´æ–‡ä»¶è·¯å¾„ï¼š
   ```bash
   gcc main.c -o main -I./include -L. -ltest  # å‡è®¾å¤´æ–‡ä»¶åœ¨ ./include ç›®å½•
   ```

2. **ç¬¦å·å†²çª**ï¼š  
   åŠ¨æ€åº“ä¸­çš„å‡½æ•°åéœ€å”¯ä¸€ï¼Œé¿å…ä¸å…¶ä»–åº“å†²çªã€‚

3. **è·¨å¹³å°å…¼å®¹**ï¼š  
   Windows åŠ¨æ€åº“ä¸º `.dll`ï¼Œéœ€ç”¨ `__declspec(dllexport)` å¯¼å‡ºå‡½æ•°ï¼ˆå‚è€ƒï¼‰ã€‚
*/